{
  "$schema": "http://json-schema.org/draft-07/schema#",

  "definitions": {
    "ref": {
      "type": "object",
      "properties": { "_ref": { "type": "string" } },
      "required": ["_ref"]
    },
    "id": {
      "type": "object",
      "properties": { "_id": { "type": "string" } },
      "required": ["_id"]
    },
    "name": {
      "type": "string",
      "description": "User-visible name of the item"
    },
    "body": {
      "type": "string",
      "description": "Markdown-formatted item body text."
    },
    "depends": {
      "description": "A step's dependencies.",
      "oneOf": [
        { "type": "array", "items": { "$ref": "#/definitions/ref" } },
        { "$ref": "#/definitions/ref" }
      ]
    },
    "timer": {
      "description": "A user-facing timer: suggested duration, 'until' predicate",
      "properties": {
        "duration": { "type": "string" },
        "until": { "type": "string" }
      }
    }
  },

  "oneOf": [
    {
      "properties": {
        "kind": { "enum": ["recipe"] },
        "id": { "$ref": "#/definitions/id" },
        "name": { "$ref": "#/definitions/name" },
        "body": { "$ref": "#/definitions/body" },
        "depends": { "$ref": "#/definitions/depends" }
      },
      "additionalProperties": false
    },
    {
      "properties": {
        "kind": { "enum": ["step"] },
        "id": { "$ref": "#/definitions/id" },
        "name": { "$ref": "#/definitions/name" },
        "body": { "$ref": "#/definitions/body" },
        "depends": { "$ref": "#/definitions/depends" },
        "timer": { "$ref": "#/definitions/timer" }
      },
      "additionalProperties": false
    },
    {
      "properties": {
        "kind": { "enum": ["ingredient"] },
        "id": { "$ref": "#/definitions/id" },
        "name": { "$ref": "#/definitions/name" }
      },
      "additionalProperties": false
    },
    {
      "properties": {
        "kind": { "enum": ["glossary"] },
        "id": { "$ref": "#/definitions/id" },
        "name": { "$ref": "#/definitions/name" },
        "body": { "$ref": "#/definitions/body" }
      },
      "additionalProperties": false
    }
  ],

  "required": ["kind"]
}
